using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Numerics;
using System.Threading;
using System.Threading.Tasks;

using Nethereum.Geth;
using Nethereum.Web3;
using Nethereum.Web3.Accounts;
using Nethereum.Web3.Accounts.Managed;
using Nethereum.Contracts;
using Nethereum.Hex.HexTypes;
using Nethereum.Hex.HexConvertors.Extensions;
using Nethereum.RPC.Eth;
using Nethereum.RPC.Eth.DTOs;
using Nethereum.RPC.Eth.Filters;
using Nethereum.ABI.FunctionEncoding.Attributes;

using Nethereum.ABI.FunctionEncoding;
using Nethereum.ABI.Model;
using Nethereum.JsonRpc.Client;

using Nethereum.ABI.Encoders;

using FDBC_Nethereum.DotNetWeb3Geth;
using Newtonsoft.Json;

namespace FDBC_Nethereum.SmartContracts
{
  public class Flight
  {
    private readonly Web3Geth _web3geth;
    private readonly string _default_sender_address;
    private readonly string _default_sender_password;
    private readonly string _test_existing_contract_address;
    private readonly int _default_retry_in_ms;
    private readonly string _contract_abi;
    private readonly string _contract_bytecode;

    public Flight(Web3Geth web3geth)
    {
      _web3geth = web3geth;
      _default_sender_address = "0x6376612e86c6f0be774cfa62e0eb732f87352115";
      _default_sender_password = "123";
      //_default_sender_address = "0x1b8fcde4948de04ab9d67600a145886a3544dfaa";
      //_default_sender_password = "dev_password";

      _default_retry_in_ms = 100;

      _contract_abi = @"[{'constant':true,'inputs':[],'name':'ufid','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'actual_departure_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'hash','outputs':[{'name':'','type':'bytes32'}],'payable':false,'type':'function'},{'constant':false,'inputs':[],'name':'PostInit','outputs':[],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'_status','type':'string'},{'name':'_actual_departure_date_time','type':'string'},{'name':'_actual_departure_date_time_local','type':'string'},{'name':'_actual_arrival_date_time','type':'string'},{'name':'_actual_arrival_date_time_local','type':'string'},{'name':'_cancel_date_time','type':'string'},{'name':'_cancel_date_time_local','type':'string'},{'name':'_deleted','type':'string'},{'name':'_flight_status_source','type':'string'},{'name':'_flight_status_fed','type':'string'},{'name':'_delay_notification_date_time','type':'string'}],'name':'set_all','outputs':[],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_deleted','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'arrival_utc_offset_hours','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_cancel_date_time','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'status','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'delay_notification_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_status','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'departure_airport','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'departure_utc_offset_hours','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_cancel_date_time_local','outputs':[],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_delay_notification_date_time','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'cancel_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'scheduled_departure_date','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'actual_departure_date_time_local','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_actual_departure_date_time','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'flight_status_fed','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'deleted','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_flight_status_fed','outputs':[],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_actual_arrival_date_time_local','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'arrival_airport','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'scheduled_departure_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_actual_departure_date_time_local','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'scheduled_arrival_date_time_local','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'scheduled_arrival_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'flight_code','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_actual_arrival_date_time','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'scheduled_departure_date_time_local','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'cancel_date_time_local','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':false,'inputs':[{'name':'task_uuid','type':'string'},{'name':'input','type':'string'}],'name':'set_flight_status_source','outputs':[],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'flight_id','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'fs_flight_code','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'actual_arrival_date_time','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'flight_status_source','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'pid','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'constant':true,'inputs':[],'name':'actual_arrival_date_time_local','outputs':[{'name':'','type':'string'}],'payable':false,'type':'function'},{'inputs':[{'name':'task_uuid','type':'string'},{'name':'_flight_id','type':'string'},{'name':'_pid','type':'string'},{'name':'_ufid','type':'string'},{'name':'_flight_code','type':'string'},{'name':'_fs_flight_code','type':'string'},{'name':'_departure_utc_offset_hours','type':'string'},{'name':'_arrival_utc_offset_hours','type':'string'},{'name':'_departure_airport','type':'string'},{'name':'_arrival_airport','type':'string'},{'name':'_scheduled_departure_date','type':'string'},{'name':'_scheduled_departure_date_time','type':'string'},{'name':'_scheduled_departure_date_time_local','type':'string'},{'name':'_scheduled_arrival_date_time','type':'string'},{'name':'_scheduled_arrival_date_time_local','type':'string'}],'payable':false,'type':'constructor'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'flight_contract_address','type':'address'}],'name':'event_new_flight','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_status','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_actual_departure_date_time','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_actual_departure_date_time_local','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_actual_arrival_date_time','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_actual_arrival_date_time_local','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_cancel_date_time','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_cancel_date_time_local','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_deleted','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_flight_status_source','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_flight_status_fed','type':'event'},{'anonymous':false,'inputs':[{'indexed':true,'name':'task_uuid','type':'bytes32'},{'indexed':false,'name':'old_val','type':'string'},{'indexed':false,'name':'new_val','type':'string'}],'name':'event_set_delay_notification_date_time','type':'event'}]";
      _contract_bytecode = "606060405234156200001057600080fd5b6040516200531b3803806200531b8339810160405280805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805182019190602001805190910190505b60008e8051620000c1929160200190620004d4565b5060018d8051620000d7929160200190620004d4565b5060028c8051620000ed929160200190620004d4565b5060038b805162000103929160200190620004d4565b5060048a805162000119929160200190620004d4565b5060058980516200012f929160200190620004d4565b50600688805162000145929160200190620004d4565b5060078780516200015b929160200190620004d4565b50600886805162000171929160200190620004d4565b50600a85805162000187929160200190620004d4565b50600b8480516200019d929160200190620004d4565b50600c838051620001b3929160200190620004d4565b50600f828051620001c9929160200190620004d4565b506010818051620001df929160200190620004d4565b50620001f864010000000062001a84620002ab82021704565b8e6040518082805190602001908083835b602083106200022b57805182525b601f19909201916020918201910162000209565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f49dfab8134d508afbfbed5727f26e09e32ef4e1cf65ebafea6f4e83808d2606530604051600160a060020a03909116815260200160405180910390a25b5050505050505050505050505050506200057e565b6003600a600760086040518085805460018160011615610100020316600290048015620003125780601f10620002ef57610100808354040283529182019162000312565b820191906000526020600020905b815481529060010190602001808311620002fd575b5050848054600181600116156101000203166002900480156200036f5780601f106200034c5761010080835404028352918201916200036f565b820191906000526020600020905b8154815290600101906020018083116200035a575b505083805460018160011615610100020316600290048015620003cc5780601f10620003a9576101008083540402835291820191620003cc565b820191906000526020600020905b815481529060010190602001808311620003b7575b505082805460018160011615610100020316600290048015620004295780601f106200040657610100808354040283529182019162000429565b820191906000526020600020905b81548152906001019060200180831162000414575b505094505050505060405190819003902060155560408051908101604052600581527f66616c73650000000000000000000000000000000000000000000000000000006020820152601690805162000486929160200190620004d4565b5060408051908101604052600581527f66616c736500000000000000000000000000000000000000000000000000000060208201526018908051620004d0929160200190620004d4565b505b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200051757805160ff191683800117855562000547565b8280016001018555821562000547579182015b82811115620005475782518255916020019190600101906200052a565b5b50620005569291506200055a565b5090565b6200057b91905b8082111562000556576000815560010162000561565b5090565b90565b614d8d806200058e6000396000f300606060405236156101e05763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630424c10481146101e55780630723f6231461027057806309bd5a60146102fb5780630a2e48f6146103205780630c505443146103355780631199fd881461065e57806313faec70146106f357806318c7688f1461077e578063200d2ed21461081357806326fb6d4e1461089e57806329c3c295146109295780632fbf1962146109be5780633ff41fce14610a49578063457b697c14610ad457806346560b8d14610b69578063486369dc14610bfe5780634aca2dbf14610c895780634be3a1ad14610d145780634c61f3a114610d9f5780635a7211ad14610e345780636b35f7c114610ebf5780637117ff6c14610f4a578063782076c514610fdf57806391cc47f01461107457806392d93c5f146110ff57806394fc4dc51461118a578063964a2d5c1461121f578063a6cd87ee146112aa578063af63770814611335578063af6c2943146113c0578063b04db85614611455578063b0b46ebb146114e0578063b0cf1f071461156b578063b5884e2614611600578063bedd1ffc1461168b578063c0d823cd14611716578063cfe792fe146117a1578063f10684541461182c578063fa6d0478146118b7575b600080fd5b34156101f057600080fd5b6101f8611942565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561027b57600080fd5b6101f86119e0565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561030657600080fd5b61030e611a7e565b60405190815260200160405180910390f35b341561032b57600080fd5b610333611a84565b005b341561034057600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650611c9995505050505050565b005b341561066957600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650612d8095505050505050565b005b34156106fe57600080fd5b6101f8612f0d565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561078957600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650612fab95505050505050565b005b341561081e57600080fd5b6101f8613138565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156108a957600080fd5b6101f86131d6565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561093457600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061327495505050505050565b005b34156109c957600080fd5b6101f8613401565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610a5457600080fd5b6101f861349f565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610adf57600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061353d95505050505050565b005b3415610b7457600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405281815292919060208401838380828437509496506136ca95505050505050565b005b3415610c0957600080fd5b6101f8613857565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610c9457600080fd5b6101f86138f5565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610d1f57600080fd5b6101f8613993565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610daa57600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650613a3195505050505050565b005b3415610e3f57600080fd5b6101f8613bbe565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610eca57600080fd5b6101f8613c5c565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3415610f5557600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650613cfa95505050505050565b005b3415610fea57600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650613e8795505050505050565b005b341561107f57600080fd5b6101f8614014565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561110a57600080fd5b6101f86140b2565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561119557600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061415095505050505050565b005b341561122a57600080fd5b6101f86142dd565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156112b557600080fd5b6101f861437b565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561134057600080fd5b6101f8614419565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156113cb57600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405281815292919060208401838380828437509496506144b795505050505050565b005b341561146057600080fd5b6101f8614644565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156114eb57600080fd5b6101f86146e2565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561157657600080fd5b61033360046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061478095505050505050565b005b341561160b57600080fd5b6101f861490d565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561169657600080fd5b6101f86149ab565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561172157600080fd5b6101f8614a49565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156117ac57600080fd5b6101f8614ae7565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561183757600080fd5b6101f8614b85565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156118c257600080fd5b6101f8614c23565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156102355780820151818401525b60200161021c565b50505050905090810190601f1680156102625780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b600d8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60155481565b6003600a600760086040518085805460018160011615610100020316600290048015611ae75780601f10611ac5576101008083540402835291820191611ae7565b820191906000526020600020905b815481529060010190602001808311611ad3575b505084805460018160011615610100020316600290048015611b405780601f10611b1e576101008083540402835291820191611b40565b820191906000526020600020905b815481529060010190602001808311611b2c575b505083805460018160011615610100020316600290048015611b995780601f10611b77576101008083540402835291820191611b99565b820191906000526020600020905b815481529060010190602001808311611b85575b505082805460018160011615610100020316600290048015611bf25780601f10611bd0576101008083540402835291820191611bf2565b820191906000526020600020905b815481529060010190602001808311611bde575b505094505050505060405190819003902060155560408051908101604052600581527f66616c736500000000000000000000000000000000000000000000000000000060208201526016908051611c4d929160200190614cc1565b5060408051908101604052600581527f66616c736500000000000000000000000000000000000000000000000000000060208201526018908051611c95929160200190614cc1565b505b565b8b6040518082805190602001908083835b60208310611cca57805182525b601f199092019160209182019101611caa565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f775048f6e5511b48bdba9d7167a14398988fb5f1174516da0fea78bb16a7cc6060098d604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015611d995780601f10611d6e57610100808354040283529160200191611d99565b820191906000526020600020905b815481529060010190602001808311611d7c57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015611dd15780820151818401525b602001611db8565b50505050905090810190601f168015611dfe5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b60208310611e3e57805182525b601f199092019160209182019101611e1e565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fbdef44ac46879f9c70461804c592244c2e78bf09247bb7a27ae00fe7d08cc6ed600d8c604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015611f0d5780601f10611ee257610100808354040283529160200191611f0d565b820191906000526020600020905b815481529060010190602001808311611ef057829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015611f455780820151818401525b602001611f2c565b50505050905090810190601f168015611f725780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b60208310611fb257805182525b601f199092019160209182019101611f92565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f8c8724fbc2fa465363c1f9e9899fa3add0491d7b0fa7598cd59b8dcbfd8f1877600e8b6040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156120815780601f1061205657610100808354040283529160200191612081565b820191906000526020600020905b81548152906001019060200180831161206457829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156120b95780820151818401525b6020016120a0565b50505050905090810190601f1680156120e65780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b6020831061212657805182525b601f199092019160209182019101612106565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f49850e312ca7ba9c18d6f314f03d79ac3e8758f406ff1a82820ebee4431764d760118a6040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156121f55780601f106121ca576101008083540402835291602001916121f5565b820191906000526020600020905b8154815290600101906020018083116121d857829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b8381101561222d5780820151818401525b602001612214565b50505050905090810190601f16801561225a5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b6020831061229a57805182525b601f19909201916020918201910161227a565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fed4210749f81cc94d525cd4ad4494df18d4c3112ad482fd19f48e755fd8d75a36012896040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156123695780601f1061233e57610100808354040283529160200191612369565b820191906000526020600020905b81548152906001019060200180831161234c57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156123a15780820151818401525b602001612388565b50505050905090810190601f1680156123ce5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b6020831061240e57805182525b601f1990920191602091820191016123ee565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f99bc47e17aea8382cddcc3caeff1aca2ce9ca24397fc2832f4a1080990b38c466013886040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156124dd5780601f106124b2576101008083540402835291602001916124dd565b820191906000526020600020905b8154815290600101906020018083116124c057829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156125155780820151818401525b6020016124fc565b50505050905090810190601f1680156125425780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b6020831061258257805182525b601f199092019160209182019101612562565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fc6abcd253dd3ed78f6a5f56536d662b009f976d22f558237218afd93c03d5d306014876040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156126515780601f1061262657610100808354040283529160200191612651565b820191906000526020600020905b81548152906001019060200180831161263457829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156126895780820151818401525b602001612670565b50505050905090810190601f1680156126b65780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b602083106126f657805182525b601f1990920191602091820191016126d6565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f7869ee11cc6ef6d36afa40dbb9213081f014daa6b79e7af8fd10f0ee632301c76016866040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156127c55780601f1061279a576101008083540402835291602001916127c5565b820191906000526020600020905b8154815290600101906020018083116127a857829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156127fd5780820151818401525b6020016127e4565b50505050905090810190601f16801561282a5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b6020831061286a57805182525b601f19909201916020918201910161284a565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f11efc5770e7eb66c1dac2016e3e98464a7ed9ac728f18184cf9626aaa22dc21c6017856040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156129395780601f1061290e57610100808354040283529160200191612939565b820191906000526020600020905b81548152906001019060200180831161291c57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156129715780820151818401525b602001612958565b50505050905090810190601f16801561299e5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b602083106129de57805182525b601f1990920191602091820191016129be565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f8448c79207f1c74f7dc14b6a82cfd9d4f5fda5e9b504e8d2449a446b77b61442601884604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015612aad5780601f10612a8257610100808354040283529160200191612aad565b820191906000526020600020905b815481529060010190602001808311612a9057829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015612ae55780820151818401525b602001612acc565b50505050905090810190601f168015612b125780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a28b6040518082805190602001908083835b60208310612b5257805182525b601f199092019160209182019101612b32565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f938a75161a4516a2cc8719fd7c452b311a66131eba9a742343ae58fc7ef39493601983604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015612c215780601f10612bf657610100808354040283529160200191612c21565b820191906000526020600020905b815481529060010190602001808311612c0457829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015612c595780820151818401525b602001612c40565b50505050905090810190601f168015612c865780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a260098b8051612ca8929160200190614cc1565b50600d8a8051612cbc929160200190614cc1565b50600e898051612cd0929160200190614cc1565b506011888051612ce4929160200190614cc1565b506012878051612cf8929160200190614cc1565b506013868051612d0c929160200190614cc1565b506014858051612d20929160200190614cc1565b506016848051612d34929160200190614cc1565b506017838051612d48929160200190614cc1565b506018828051612d5c929160200190614cc1565b506019818051612d70929160200190614cc1565b505b505050505050505050505050565b816040518082805190602001908083835b60208310612db157805182525b601f199092019160209182019101612d91565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f7869ee11cc6ef6d36afa40dbb9213081f014daa6b79e7af8fd10f0ee632301c7601683604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015612e805780601f10612e5557610100808354040283529160200191612e80565b820191906000526020600020905b815481529060010190602001808311612e6357829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015612eb85780820151818401525b602001612e9f565b50505050905090810190601f168015612ee55780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26016818051612f07929160200190614cc1565b505b5050565b60068054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b60208310612fdc57805182525b601f199092019160209182019101612fbc565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f99bc47e17aea8382cddcc3caeff1aca2ce9ca24397fc2832f4a1080990b38c466013836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156130ab5780601f10613080576101008083540402835291602001916130ab565b820191906000526020600020905b81548152906001019060200180831161308e57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156130e35780820151818401525b6020016130ca565b50505050905090810190601f1680156131105780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26013818051612f07929160200190614cc1565b505b5050565b60098054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60198054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b602083106132a557805182525b601f199092019160209182019101613285565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f775048f6e5511b48bdba9d7167a14398988fb5f1174516da0fea78bb16a7cc606009836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156133745780601f1061334957610100808354040283529160200191613374565b820191906000526020600020905b81548152906001019060200180831161335757829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156133ac5780820151818401525b602001613393565b50505050905090810190601f1680156133d95780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26009818051612f07929160200190614cc1565b505b5050565b60078054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60058054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b6020831061356e57805182525b601f19909201916020918201910161354e565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fc6abcd253dd3ed78f6a5f56536d662b009f976d22f558237218afd93c03d5d3060148360405160408082528354600260001961010060018416150201909116049082018190528190602082019060608301908690801561363d5780601f106136125761010080835404028352916020019161363d565b820191906000526020600020905b81548152906001019060200180831161362057829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156136755780820151818401525b60200161365c565b50505050905090810190601f1680156136a25780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26014818051612f07929160200190614cc1565b505b5050565b816040518082805190602001908083835b602083106136fb57805182525b601f1990920191602091820191016136db565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f938a75161a4516a2cc8719fd7c452b311a66131eba9a742343ae58fc7ef394936019836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156137ca5780601f1061379f576101008083540402835291602001916137ca565b820191906000526020600020905b8154815290600101906020018083116137ad57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156138025780820151818401525b6020016137e9565b50505050905090810190601f16801561382f5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26019818051612f07929160200190614cc1565b505b5050565b60138054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b600a8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b600e8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b60208310613a6257805182525b601f199092019160209182019101613a42565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fbdef44ac46879f9c70461804c592244c2e78bf09247bb7a27ae00fe7d08cc6ed600d83604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015613b315780601f10613b0657610100808354040283529160200191613b31565b820191906000526020600020905b815481529060010190602001808311613b1457829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015613b695780820151818401525b602001613b50565b50505050905090810190601f168015613b965780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a2600d818051612f07929160200190614cc1565b505b5050565b60188054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60168054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b60208310613d2b57805182525b601f199092019160209182019101613d0b565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f8448c79207f1c74f7dc14b6a82cfd9d4f5fda5e9b504e8d2449a446b77b61442601883604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015613dfa5780601f10613dcf57610100808354040283529160200191613dfa565b820191906000526020600020905b815481529060010190602001808311613ddd57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015613e325780820151818401525b602001613e19565b50505050905090810190601f168015613e5f5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26018818051612f07929160200190614cc1565b505b5050565b816040518082805190602001908083835b60208310613eb857805182525b601f199092019160209182019101613e98565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207fed4210749f81cc94d525cd4ad4494df18d4c3112ad482fd19f48e755fd8d75a3601283604051604080825283546002600019610100600184161502019091160490820181905281906020820190606083019086908015613f875780601f10613f5c57610100808354040283529160200191613f87565b820191906000526020600020905b815481529060010190602001808311613f6a57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b83811015613fbf5780820151818401525b602001613fa6565b50505050905090810190601f168015613fec5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26012818051612f07929160200190614cc1565b505b5050565b60088054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b600b8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b6020831061418157805182525b601f199092019160209182019101614161565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f8c8724fbc2fa465363c1f9e9899fa3add0491d7b0fa7598cd59b8dcbfd8f1877600e836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156142505780601f1061422557610100808354040283529160200191614250565b820191906000526020600020905b81548152906001019060200180831161423357829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156142885780820151818401525b60200161426f565b50505050905090810190601f1680156142b55780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a2600e818051612f07929160200190614cc1565b505b5050565b60108054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b600f8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b602083106144e857805182525b601f1990920191602091820191016144c8565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f49850e312ca7ba9c18d6f314f03d79ac3e8758f406ff1a82820ebee4431764d76011836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156145b75780601f1061458c576101008083540402835291602001916145b7565b820191906000526020600020905b81548152906001019060200180831161459a57829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156145ef5780820151818401525b6020016145d6565b50505050905090810190601f16801561461c5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26011818051612f07929160200190614cc1565b505b5050565b600c8054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60148054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b816040518082805190602001908083835b602083106147b157805182525b601f199092019160209182019101614791565b6001836020036101000a03801982511681845116179092525050509190910192506040915050519081900390207f11efc5770e7eb66c1dac2016e3e98464a7ed9ac728f18184cf9626aaa22dc21c6017836040516040808252835460026000196101006001841615020190911604908201819052819060208201906060830190869080156148805780601f1061485557610100808354040283529160200191614880565b820191906000526020600020905b81548152906001019060200180831161486357829003601f168201915b5050838103825284818151815260200191508051906020019080838360005b838110156148b85780820151818401525b60200161489f565b50505050905090810190601f1680156148e55780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a26017818051612f07929160200190614cc1565b505b5050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60118054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60178054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b60128054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119d85780601f106119ad576101008083540402835291602001916119d8565b820191906000526020600020905b8154815290600101906020018083116119bb57829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10614d0257805160ff1916838001178555614d2f565b82800160010185558215614d2f579182015b82811115614d2f578251825591602001919060010190614d14565b5b50614d3c929150614d40565b5090565b614d5e91905b80821115614d3c5760008155600101614d46565b5090565b905600a165627a7a72305820a1cd5567502d65ae351b4c09792f5979809597339a5e6ec544b2d04b1060f5500029";
    }

    public async Task<string> Create(
      string task_uuid,
      string flight_id, string pid, string ufid,
      string flight_code, string fs_flight_code,
      string departure_utc_offset_hours, string arrival_utc_offset_hours,
      string departure_airport, string arrival_airport,
      string scheduled_departure_date,
      string scheduled_departure_date_time, string scheduled_departure_date_time_local,
      string scheduled_arrival_date_time, string scheduled_arrival_date_time_local)
    {
      Web3Geth web3geth = _web3geth;
      string sender_address = _default_sender_address;
      string sender_password = _default_sender_password;
      string contract_abi = _contract_abi;
      string contract_bytecode = _contract_bytecode;

      ////====================================
      //// deploy contract

      // unlock for 120 secs

      //bool bool_result = await web3geth.Miner.Start.SendRequestAsync(120);

      var gas = new HexBigInteger(7000000);
      var wei = new HexBigInteger(0);
      string tx_hash = await web3geth.Eth.DeployContract.SendRequestAsync(
        abi: contract_abi,
        contractByteCode: contract_bytecode,
        from: sender_address,
        gas: gas,
        value: wei,
        values: new object[] {
          task_uuid,
          flight_id,
          pid,
          ufid,
          flight_code,
          fs_flight_code,
          departure_utc_offset_hours ,
          arrival_utc_offset_hours,
          departure_airport,
          arrival_airport,
          scheduled_departure_date,
          scheduled_departure_date_time,
          scheduled_departure_date_time_local,
          scheduled_arrival_date_time,
          scheduled_arrival_date_time_local
        });

      return tx_hash;
    }

    public async Task<Tuple<string, string>> GetTransactionResult_Create(string tx_hash)
    {
      TransactionReceipt receipt = await GetTransactionReceiptAsync(tx_hash);

      string stringified_receipt = JsonConvert.SerializeObject(receipt);
      string stringified_event_log = "";

      return new Tuple<string, string>(stringified_receipt, stringified_event_log);
    }

    public async Task<string> SetFlightAllAttributes(
      string contract_address,
      string task_uuid,
      string status,
      string actual_departure_date_time,
      string actual_departure_date_time_local,
      string actual_arrival_date_time,
      string actual_arrival_date_time_local,
      string cancel_date_time,
      string cancel_date_time_local,
      string deleted,
      string flight_status_source,
      string flight_status_fed,
      string delay_notification_date_time
      )
    {
      // SmartContract function doesn't take null as input for string
      status = status ?? "";
      actual_departure_date_time = actual_departure_date_time ?? "";
      actual_departure_date_time_local = actual_departure_date_time_local ?? "";
      actual_arrival_date_time = actual_arrival_date_time ?? "";
      actual_arrival_date_time_local = actual_arrival_date_time_local ?? "";
      cancel_date_time = cancel_date_time ?? "";
      cancel_date_time_local = cancel_date_time_local ?? "";
      deleted = deleted ?? "";
      flight_status_source = flight_status_source ?? "";
      flight_status_fed = flight_status_fed ?? "";
      delay_notification_date_time = delay_notification_date_time ?? "";

      // Web3
      Web3Geth web3geth = _web3geth;
      string sender_address = _default_sender_address;
      string contract_abi = _contract_abi;

      Contract contract = web3geth.Eth.GetContract(contract_abi, contract_address);

      string task_uuid_sha3 = $"0x{_web3geth.Sha3(task_uuid)}";
      byte[] task_uuid_sha3_bytes32 = task_uuid_sha3.HexToByteArray();

      Function set_function = contract.GetFunction("set_all");

      var gas = new HexBigInteger(4700000);
      var wei = new HexBigInteger(0);
      var tx_hash = await set_function.SendTransactionAsync(
        from: sender_address, gas: gas, value: wei,
        functionInput: new object[] {
          task_uuid,
          status,
          actual_departure_date_time,
          actual_departure_date_time_local,
          actual_arrival_date_time,
          actual_arrival_date_time_local,
          cancel_date_time,
          cancel_date_time_local,
          deleted,
          flight_status_source,
          flight_status_fed,
          delay_notification_date_time
        });

      return tx_hash;
    }

    public async Task<Tuple<string, string>> GetTransactionResult_SetFlightAllAttributes(string tx_hash)
    {
      TransactionReceipt receipt = await GetTransactionReceiptAsync(tx_hash);

      string stringified_receipt = JsonConvert.SerializeObject(receipt);
      string stringified_event_log = "";

      return new Tuple<string, string>(stringified_receipt, stringified_event_log);
    }

    private async Task<TransactionReceipt> GetTransactionReceiptAsync(string tx_hash)
    {
      Web3Geth web3geth = _web3geth;
      int web3_transaction_check_delay_in_ms = _default_retry_in_ms;

      TransactionReceipt receipt = null;
      while (receipt == null)
      {
        await Task.Delay(web3_transaction_check_delay_in_ms);
        receipt = await web3geth.Eth.Transactions.GetTransactionReceipt.SendRequestAsync(tx_hash);
      }

      return receipt;
    }

    //public async Task<Tuple<string, string>> SetFlightAttribute(string contract_address, string task_uuid, string attribute_name, string attribute_value)
    //{
    //  Web3Geth web3geth = _web3geth;
    //  string sender_address = _default_sender_address;
    //  string contract_abi = _contract_abi;

    //  Contract contract = web3geth.Eth.GetContract(contract_abi, contract_address);

    //  string task_uuid_sha3 = $"0x{_web3geth.Sha3(task_uuid)}";
    //  byte[] task_uuid_sha3_bytes32 = task_uuid_sha3.HexToByteArray();

    //  var set_event = contract.GetEvent($"event_set_{attribute_name}");
    //  var set_event_filter_by_task_uuid = await set_event.CreateFilterAsync(new[] { task_uuid_sha3_bytes32 });

    //  Function set_function = contract.GetFunction($"set_{attribute_name}");

    //  var wei = new HexBigInteger(0);
    //  var tx_hash = await set_function.SendTransactionAsync(from: sender_address, gas: new HexBigInteger(4700000), value: wei, functionInput: new object[] { task_uuid, attribute_value });

    //  int web3_transaction_check_delay_in_ms = _default_retry_in_ms;

    //  TransactionReceipt receipt = null;
    //  while (receipt == null)
    //  {
    //    await Task.Delay(web3_transaction_check_delay_in_ms);
    //    receipt = await web3geth.Eth.Transactions.GetTransactionReceipt.SendRequestAsync(tx_hash);
    //  }

    //  var set_event_logs = await set_event.GetFilterChanges<EventSetFlightAttribute>(set_event_filter_by_task_uuid);

    //  await web3geth.Eth.Filters.UninstallFilter.SendRequestAsync(set_event_filter_by_task_uuid);

    //  string stringified_receipt = JsonConvert.SerializeObject(receipt);
    //  string stringified_event_log = JsonConvert.SerializeObject(set_event_logs.FirstOrDefault());

    //  return new Tuple<string, string>(stringified_receipt, stringified_event_log);
    //}

    //public async Task SetStatus(string task_uuid, string input)
    //{
    //  Web3Geth web3geth = _web3geth;
    //  string sender_address = _default_sender_address;
    //  string contract_address = _test_existing_contract_address;
    //  string contract_abi = _contract_abi;
    //  string contract_bytecode = _contract_bytecode;

    //  // connection problem? Windows firewall TCP 8545
    //  // TODO 測試 deploy to local blockchain => test local set function and event

    //  Contract contract = web3geth.Eth.GetContract(contract_abi, contract_address);

    //  string task_uuid_sha3 = $"0x{_web3geth.Sha3(task_uuid)}";
    //  //Bytes32TypeEncoder encoder = new Bytes32TypeEncoder();
    //  //byte[] task_uuid_sha3_bytes32 = encoder.Encode(task_uuid_sha3);
    //  byte[] task_uuid_sha3_bytes32 = task_uuid_sha3.HexToByteArray();

    //  var set_status_event = contract.GetEvent("event_set_status");
    //  var set_status_event_filter = await set_status_event.CreateFilterAsync(task_uuid_sha3_bytes32);

    //  Function set_status_function = contract.GetFunction("set_status");

    //  var wei = new HexBigInteger(0);
    //  var tx_hash = await set_status_function.SendTransactionAsync(from: sender_address, gas: new HexBigInteger(4700000), value: wei, functionInput: new object[] { task_uuid, input });

    //  //bool bool_result = await web3geth.Miner.Start.SendRequestAsync(120);

    //  int web3_transaction_check_delay_in_ms = _default_retry_in_ms;

    //  TransactionReceipt receipt = null;
    //  while (receipt == null)
    //  {
    //    await Task.Delay(web3_transaction_check_delay_in_ms);
    //    receipt = await web3geth.Eth.Transactions.GetTransactionReceipt.SendRequestAsync(tx_hash);
    //  }

    //  //bool_result = await web3geth.Miner.Stop.SendRequestAsync();

    //  //var set_status_event_logs = await set_status_event.GetFilterChanges<EventSetFlightAttribute>(set_status_event_filter);

    //  //bool uninstall_successful = await _web3geth.Eth.Filters.UninstallFilter.SendRequestAsync(set_status_event_filter);
    //}

    public class EventNewFlight
    {
      [Parameter("bytes32", "task_uuid", 1, true)]
      public byte[] task_uuid { get; set; }

      [Parameter("address", "flight_contract_address", 2, false)]
      public string flight_contract_address { get; set; }
    }

    public class EventSetFlightAttribute
    {
      [Parameter("bytes32", "task_uuid", 1, true)]
      public byte[] task_uuid { get; set; }

      [Parameter("string", "old_val", 2, false)]
      public string old_val { get; set; }

      [Parameter("string", "new_val", 3, false)]
      public string new_val { get; set; }
    }

  }
}
